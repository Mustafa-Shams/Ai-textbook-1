openapi: 3.0.0
info:
  title: Docusaurus RAG Companion API
  description: API for the Docusaurus RAG Companion feature
  version: 1.0.0
  contact:
    name: API Support
    email: support@example.com

servers:
  - url: https://ai-textbook-1-production.up.railway.app
    description: Production server

paths:
  /chat:
    post:
      summary: Process user message and return RAG response
      description: |
        Main endpoint for the RAG system. Accepts user message and optional selected context,
        performs semantic search if needed, and returns AI-generated response with citations.
      operationId: chat
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChatRequest'
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ChatResponse'
        '429':
          description: Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RateLimitResponse'
        '400':
          description: Bad request - invalid input
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
      security:
        - api_key: []
      x-rateLimit:
        limit: 10
        window: 60s
        per: ip

  /sessions:
    get:
      summary: Get all chat sessions for a user
      description: Retrieve a list of all chat sessions with basic information
      operationId: getSessions
      responses:
        '200':
          description: List of chat sessions
          content:
            application/json:
              schema:
                type: object
                properties:
                  sessions:
                    type: array
                    items:
                      $ref: '#/components/schemas/SessionInfo'
        '401':
          description: Unauthorized
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /sessions/{sessionId}:
    get:
      summary: Get specific chat session
      description: Retrieve all messages in a specific chat session
      operationId: getSession
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Chat session details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionDetails'
        '404':
          description: Session not found
        '401':
          description: Unauthorized
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    ChatRequest:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          description: User's message or question
          example: "Explain how neural networks work"
        sessionId:
          type: string
          format: uuid
          description: Optional session ID to continue existing conversation
          example: "550e8400-e29b-41d4-a716-446655440000"
        selectedContext:
          type: string
          description: Optional context from selected text in the document
          example: "Neural networks are computing systems inspired by the human brain..."

    ChatResponse:
      type: object
      required:
        - response
        - sessionId
      properties:
        response:
          type: string
          description: AI-generated response to the user's message
          example: "Neural networks are computing systems that mimic the structure of the human brain..."
        sessionId:
          type: string
          format: uuid
          description: Session ID for the conversation
          example: "550e8400-e29b-41d4-a716-446655440000"
        sources:
          type: array
          description: List of source documents/references used
          items:
            type: string
          example: ["/docs/intro.md", "/docs/neural-networks.md"]
        contextUsed:
          type: array
          description: Specific content chunks used for the response
          items:
            type: object
            properties:
              content:
                type: string
              source:
                type: string

    SessionInfo:
      type: object
      required:
        - id
        - title
        - updatedAt
      properties:
        id:
          type: string
          format: uuid
          description: Session ID
          example: "550e8400-e29b-41d4-a716-446655440000"
        title:
          type: string
          description: Auto-generated title for the session
          example: "Questions about neural networks"
        updatedAt:
          type: string
          format: date-time
          description: Last updated timestamp
          example: "2023-10-20T10:00:00Z"

    SessionDetails:
      type: object
      required:
        - id
        - title
        - messages
      properties:
        id:
          type: string
          format: uuid
          description: Session ID
          example: "550e8400-e29b-41d4-a716-446655440000"
        title:
          type: string
          description: Auto-generated title for the session
          example: "Questions about neural networks"
        messages:
          type: array
          items:
            $ref: '#/components/schemas/ChatMessage'
        createdAt:
          type: string
          format: date-time
          description: Session creation timestamp
          example: "2023-10-20T09:00:00Z"
        updatedAt:
          type: string
          format: date-time
          description: Last updated timestamp
          example: "2023-10-20T10:00:00Z"

    ChatMessage:
      type: object
      required:
        - id
        - role
        - content
        - timestamp
      properties:
        id:
          type: string
          format: uuid
          description: Message ID
          example: "550e8400-e29b-41d4-a716-446655440001"
        role:
          type: string
          enum: [user, assistant]
          description: Sender of the message
          example: "user"
        content:
          type: string
          description: Message content
          example: "Explain how neural networks work"
        timestamp:
          type: string
          format: date-time
          description: When the message was created
          example: "2023-10-20T10:00:00Z"
        contextUsed:
          type: array
          description: Context used for assistant responses
          items:
            type: object
            properties:
              content:
                type: string
              source:
                type: string

    RateLimitResponse:
      type: object
      required:
        - error
        - message
        - retryAfter
      properties:
        error:
          type: string
          example: "rate_limit_exceeded"
        message:
          type: string
          example: "Rate limit exceeded. Please try again later."
        retryAfter:
          type: integer
          description: Number of seconds to wait before retrying
          example: 60

    ErrorResponse:
      type: object
      required:
        - error
        - message
      properties:
        error:
          type: string
          example: "internal_error"
        message:
          type: string
          example: "An internal error occurred"

  securitySchemes:
    api_key:
      type: apiKey
      in: header
      name: X-API-Key
      description: Optional API key for authentication (public access with rate limiting by default)